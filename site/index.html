<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-2525412533157824",
            enable_page_level_ads: true
        });
    </script>

    <title></title>
    <meta charset="utf-8">
    <meta name="author" content="Eric Miller" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/files/images/favicon.png">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://code.cdn.mozilla.net/fonts/fira.css">
    <link rel="stylesheet" href="/css/main.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- Begin Jekyll SEO tag v2.1.0 -->
<meta property="og:title" content="Eric Miller’s Website" />
<meta name="description" content="My personal website. A place for my stuff." />
<meta property="og:description" content="My personal website. A place for my stuff." />
<link rel="canonical" href="http://localhost:4000/" />
<meta property="og:url" content="http://localhost:4000/" />
<meta property="og:site_name" content="Eric Miller’s Website" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "WebSite",
"name": "Eric Miller’s Website",
"headline": "Eric Miller’s Website",
"description": "My personal website. A place for my stuff.",
"url": "http://localhost:4000/"}</script>
<!-- End Jekyll SEO tag -->


    <script>
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '364422673926680',
                xfbml      : true,
                version    : 'v2.8'
            });
            FB.AppEvents.logPageView();
        };

        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

    <!-- Project Wonderful Ad Box Loader -->
    <script type="text/javascript">
        (function(){function pw_load(){
            if(arguments.callee.z)return;else arguments.callee.z=true;
            var d=document;var s=d.createElement('script');
            var x=d.getElementsByTagName('script')[0];
            s.type='text/javascript';s.async=true;
            s.src='//www.projectwonderful.com/pwa.js';
            x.parentNode.insertBefore(s,x);}
            if (window.attachEvent){
                window.attachEvent('DOMContentLoaded',pw_load);
                window.attachEvent('onload',pw_load);}
            else{
                window.addEventListener('DOMContentLoaded',pw_load,false);
                window.addEventListener('load',pw_load,false);}})();
    </script>
    <!-- End Project Wonderful Ad Box Loader -->
</head>
<body>
    <div id="wrapper">
        <div id="header-wrapper">
            <nav class="navbar navbar-default navbar-custom">
                <div class="container-fluid">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <li><a href="/">Home</a></li>
                            <li><a href="/posts/">All Posts</a></li>
                            <li class="dropdown">
                                <a class="dropdown-toggle" data-toggle="dropdown"  href="#">Categories  <span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    
                                    
                                    <li><a href="/Apple">Apple</a></li>
                                    
                                    <li><a href="/Photos">Photos</a></li>
                                    
                                    <li><a href="/Review">Review</a></li>
                                    
                                    <li><a href="/Security">Security</a></li>
                                    
                                    <li><a href="/Technology">Technology</a></li>
                                    
                                    <li><a href="/Tutorial">Tutorial</a></li>
                                    
                                </ul>
                            </li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="/dev/null/">Complaints</a></li>
                            <li><a href="mailto:sosheskaz.github.io@gmail.com">Contact</a></li>
                            <li><a href="/feed.xml">RSS</a></li>
                            <li><a href="/about/">About Me</a></li>
                        </ul>
                    </div><!-- /.navbar-collapse -->
                </div><!-- /.container-fluid -->
            </nav>
        </div>
    </div>

<div class="col-md-1"></div>
<div id="page-content-wrapper" class="content col-md-10">
    <div class="home">

    <h1 class="post-title"><a href="/tutorial/2017/03/28/FreeBSD-rcd-Setup.html">How to Make a Basic rc.d Script in FreeBSD</a></h1>

    <!-- Project Wonderful Ad Box Code -->
    <div style="text-align:center;"><div style="display:inline-block;" id="pw_adbox_80042_1_0"></div></div>
    <script type="text/javascript"></script>
    <noscript><div style="text-align:center;"><div style="display:inline-block;"><map name="admap80042" id="admap80042"><area href="https://www.projectwonderful.com/out_nojs.php?r=0&c=0&id=80042&type=1" shape="rect" coords="0,0,468,60" title="" alt="" target="_blank" rel="noopener noreferrer" /></map>
        <table cellpadding="0" cellspacing="0" style="width:468px;border-style:none;background-color:#ffffff;"><tr><td><img src="https://www.projectwonderful.com/nojs.php?id=80042&type=1" style="width:468px;height:60px;border-style:none;" usemap="#admap80042" alt="" /></td></tr><tr><td style="background-color:#ffffff;" colspan="1"><center><a style="font-size:10px;color:#0000ff;text-decoration:none;line-height:1.2;font-weight:bold;font-family:Tahoma, verdana,arial,helvetica,sans-serif;text-transform: none;letter-spacing:normal;text-shadow:none;white-space:normal;word-spacing:normal;" href="https://www.projectwonderful.com/advertisehere.php?id=80042&type=1" target="_blank">Ads by Project Wonderful!  Your ad here, right now: $0</a></center></td></tr></table></div></div>
    </noscript>
    <!-- End Project Wonderful Ad Box Code -->

    <div>
        <p>Recently, I wanted to make an rc.d script for my FreeBSD server, in order to include TeamCity in the 
<code class="highlighter-rouge">service</code> interface, which in FreeBSD is linked to the rc.d system, as opposed to Linux’s systemd system.
I was unable to find an easy tutorial, until I stumbled upon a Minecraft forum where I found information on
a suitable script. The rc.d system is actually rather nice to work with, and in my opinion, confers more
power to the user than does systemd. This is largely thanks to the <code class="highlighter-rouge">/etc/rc.conf</code> file. That said, writing
an rc.d script is relatively easy once you understand how to do it.</p>

<p>The first step is to set up the script that tells <code class="highlighter-rouge">service</code> how to understand what to do. 
For the purpose of this tutorial, I’ll call the service <code class="highlighter-rouge">myservice</code>. The first thing
to do is put a script in the <code class="highlighter-rouge">/usr/local/etc/rc.d/</code> folder. Name this file the name of your service, in
this case <code class="highlighter-rouge">myservice</code>. This means the absolute path of this file is <code class="highlighter-rouge">/usr/local/etc/rc.d/myservice</code>.
Finally, make this file executable using <code class="highlighter-rouge">chmod +x /usr/local/etc/rc.d/myservice</code>.</p>

<p>Now, edit the file. The first step is the hashbang, which should be put on the first line. This lets the 
program know how to start the script independently. Your file should look like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
</code></pre>
</div>

<p>Next, we need to tell it how to use the rc subrouting. This is basically just boilerplate; add 
<code class="highlighter-rouge">. /etc/rc.subr</code> to the file. Your file will now look like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

. /etc/rc.subr
</code></pre>
</div>

<p>Now, it’s time to put in some metadata so that rc.d understands some basic information about this service.
Again, this is, to some extent, boilerplate to work with the rc.d system.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>name="myservice" # How the service will be invoked from service
rcvar="${name}_enable" # The variable in rc.conf that will allow this service to run
load_rc_config $name # Loads the config file, if relevant.
</code></pre>
</div>

<p>Okay, this script is set up to work with the rc.d system. Now, we need to tell it what to do. The first
thing is to set up any environment variables your service may need. You may or may not need to do this,
depending on the nature of your service. Let’s say <code class="highlighter-rouge">myservice</code> needs Java to run, so we need to add the
<code class="highlighter-rouge">JRE_HOME</code> environment variable.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>export JRE_HOME="/usr/local"
</code></pre>
</div>

<p>Excellent! Now it’s time to tell service what to do when it uses particular commands. In this example, I’ll
say we’re using 3 commands: start, stop, and status. To do this, we set up a variable for each command,
where the value is the <code class="highlighter-rouge">sh</code> code to run. For complicated setups, you’re best off setting this up to be an
independent file, or initializing these values as functions rather than variables. For the sake of
simplicity in the example, I’m going to use quick <code class="highlighter-rouge">sh</code> one-liners. For reference, the variable names we use
are <code class="highlighter-rouge">start_cmd</code>, <code class="highlighter-rouge">stop_cmd</code>, and <code class="highlighter-rouge">status_cmd</code>. Also note, in this example I’m assuming that <code class="highlighter-rouge">myservice</code>
starts as a daemon, and stores its PID in a file called <code class="highlighter-rouge">myservice.pid</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pidfile="/home/ericmiller/myservice/myservice.pid"
start_cmd="/home/ericmiller/myservice/start ; echo MyService is now running on PID $(cat $pidfile)"
stop_cmd="/home/ericmiller/myservice/stop ; echo MyService is not running. ; rm $(cat $pidfile)"
status_cmd="if [ -e $pidfile ]; then echo MyService is running on PID $(cat $pidfile). ; return 1; fi; echo MyService is not running. ; return 0"
</code></pre>
</div>

<p>Okay, we’re almost done. Now we just need to tell rc.d to run the appropriate command based on the user’s
input. This is done with the following line:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>run_rc_command "$1"
</code></pre>
</div>

<p>Okay! That’s all you need for the script. Here’s what our <code class="highlighter-rouge">/usr/local/etc/rc.d/myservice</code> script looks like:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

. /etc/rc.subr

<span class="nv">name</span><span class="o">=</span><span class="s2">"myservice"</span> <span class="c"># How the service will be invoked from service</span>
<span class="nv">rcvar</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">name</span><span class="k">}</span><span class="s2">_enable"</span> <span class="c"># The variable in rc.conf that will allow this service to run</span>
load_rc_config <span class="nv">$name</span> <span class="c"># Loads the config file, if relevant.</span>

<span class="nb">export </span><span class="nv">JRE_HOME</span><span class="o">=</span><span class="s2">"/usr/local"</span>

<span class="nv">pidfile</span><span class="o">=</span><span class="s2">"/home/ericmiller/myservice/myservice.pid"</span>
<span class="nv">start_cmd</span><span class="o">=</span><span class="s2">"/home/ericmiller/myservice/start ; echo MyService is now running on PID </span><span class="k">$(</span>cat <span class="nv">$pidfile</span><span class="k">)</span><span class="s2">"</span>
<span class="nv">stop_cmd</span><span class="o">=</span><span class="s2">"/home/ericmiller/myservice/stop ; echo MyService is not running. ; rm </span><span class="k">$(</span>cat <span class="nv">$pidfile</span><span class="k">)</span><span class="s2">"</span>
<span class="nv">status_cmd</span><span class="o">=</span><span class="s2">"if [ -e </span><span class="nv">$pidfile</span><span class="s2"> ]; then echo MyService is running on PID </span><span class="k">$(</span>cat <span class="nv">$pidfile</span><span class="k">)</span><span class="s2">. ; return 1; fi; echo MyService is not running. ; return 0"</span>

run_rc_command <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
</code></pre>
</div>

<p>Now, there’s one last step. If you try to run the service with <code class="highlighter-rouge">service start myservice</code>, it’ll give you
a message telling you that you need to enable it in <code class="highlighter-rouge">/etc/rc.conf</code>. You can do this with one simple command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>echo myservice_enable="YES" &gt;&gt; /etc/rc.conf
</code></pre>
</div>

<p>Congrats! Your rc.d script is set up and ready to go.</p>


    </div>

    <div class="fb-like" data-href="http://localhost:4000/tutorial/2017/03/28/FreeBSD-rcd-Setup.html" data-layout="standard" data-action="like"
         data-size="large" data-show-faces="true" data-share="true"></div>
    <br>
    <hr>
</div>

</div>
<div class="col-md-1"></div>
</body>
</html>